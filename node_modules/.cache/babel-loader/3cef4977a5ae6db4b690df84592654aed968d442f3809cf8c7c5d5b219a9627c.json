{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\PC\\\\Desktop\\\\chatbot\\\\src\\\\components\\\\Chat\\\\ChatWindow.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { io } from 'socket.io-client';\nimport { useAuth } from '../../contexts/AuthContext';\nimport MessageBubble from './MessageBubble';\nimport ChatHeader from './ChatHeader';\nimport ChatInput from './ChatInput';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatWindow = ({\n  chatId\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [socket, setSocket] = useState(null);\n  const [isTyping, setIsTyping] = useState(false);\n  const [typingUser, setTypingUser] = useState('');\n  const messagesEndRef = useRef(null);\n  const {\n    token\n  } = useAuth();\n\n  // Initialize socket connection\n  useEffect(() => {\n    const newSocket = io(process.env.REACT_APP_API_URL || 'http://localhost:5000', {\n      auth: {\n        token: `Bearer ${token}`\n      }\n    });\n    setSocket(newSocket);\n\n    // Join the specific chat room\n    newSocket.emit('join_chat', chatId);\n\n    // Listen for new messages\n    newSocket.on('receive_message', messageData => {\n      setMessages(prev => [...prev, messageData]);\n    });\n\n    // Listen for typing indicators\n    newSocket.on('user_typing', ({\n      user,\n      isTyping: typingStatus\n    }) => {\n      if (typingStatus) {\n        setTypingUser(user);\n        setIsTyping(true);\n      } else {\n        setIsTyping(false);\n      }\n    });\n\n    // Cleanup on unmount\n    return () => {\n      newSocket.off('receive_message');\n      newSocket.off('user_typing');\n      newSocket.disconnect();\n    };\n  }, [chatId, token]);\n\n  // Scroll to bottom when messages change\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages]);\n\n  // Handle sending a message\n  const handleSendMessage = content => {\n    if (socket && content.trim() !== '') {\n      const newMessage = {\n        _id: Date.now().toString(),\n        sender: 'current_user',\n        // This would be the actual user ID\n        senderType: 'user',\n        content,\n        timestamp: new Date(),\n        read: false,\n        sentiment: 'neutral'\n      };\n      socket.emit('send_message', {\n        chatId,\n        message: newMessage\n      });\n      setMessages(prev => [...prev, newMessage]);\n    }\n  };\n\n  // Handle typing start/stop\n  const handleTypingStart = () => {\n    if (socket) {\n      socket.emit('typing_start', {\n        chatId,\n        user: 'current_user'\n      });\n    }\n  };\n  const handleTypingStop = () => {\n    if (socket) {\n      socket.emit('typing_stop', {\n        chatId,\n        user: 'current_user'\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-window\",\n    children: [/*#__PURE__*/_jsxDEV(ChatHeader, {\n      chatId: chatId\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-messages\",\n      children: [messages.map(message => /*#__PURE__*/_jsxDEV(MessageBubble, {\n        message: message\n      }, message._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }, this)), isTyping && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"typing-indicator\",\n        children: [typingUser, \" is typing...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatInput, {\n      onSendMessage: handleSendMessage,\n      onTypingStart: handleTypingStart,\n      onTypingStop: handleTypingStop\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatWindow, \"ufKzQO23EKnq5NrqJe3lEADR/gM=\", false, function () {\n  return [useAuth];\n});\n_c = ChatWindow;\nexport default ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useState","useEffect","useRef","io","useAuth","MessageBubble","ChatHeader","ChatInput","jsxDEV","_jsxDEV","ChatWindow","chatId","_s","messages","setMessages","socket","setSocket","isTyping","setIsTyping","typingUser","setTypingUser","messagesEndRef","token","newSocket","process","env","REACT_APP_API_URL","auth","emit","on","messageData","prev","user","typingStatus","off","disconnect","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSendMessage","content","trim","newMessage","_id","Date","now","toString","sender","senderType","timestamp","read","sentiment","message","handleTypingStart","handleTypingStop","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","ref","onSendMessage","onTypingStart","onTypingStop","_c","$RefreshReg$"],"sources":["C:/Users/PC/Desktop/chatbot/src/components/Chat/ChatWindow.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport MessageBubble from './MessageBubble';\r\nimport ChatHeader from './ChatHeader';\r\nimport ChatInput from './ChatInput';\r\nimport { Message } from '../../types/chat';\r\n\r\ninterface ChatWindowProps {\r\n  chatId: string;\r\n}\r\n\r\nconst ChatWindow: React.FC<ChatWindowProps> = ({ chatId }) => {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [socket, setSocket] = useState<Socket | null>(null);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [typingUser, setTypingUser] = useState('');\r\n  const messagesEndRef = useRef<null | HTMLDivElement>(null);\r\n  const { token } = useAuth();\r\n\r\n  // Initialize socket connection\r\n  useEffect(() => {\r\n    const newSocket = io(process.env.REACT_APP_API_URL || 'http://localhost:5000', {\r\n      auth: {\r\n        token: `Bearer ${token}`\r\n      }\r\n    });\r\n\r\n    setSocket(newSocket);\r\n\r\n    // Join the specific chat room\r\n    newSocket.emit('join_chat', chatId);\r\n\r\n    // Listen for new messages\r\n    newSocket.on('receive_message', (messageData) => {\r\n      setMessages(prev => [...prev, messageData]);\r\n    });\r\n\r\n    // Listen for typing indicators\r\n    newSocket.on('user_typing', ({ user, isTyping: typingStatus }) => {\r\n      if (typingStatus) {\r\n        setTypingUser(user);\r\n        setIsTyping(true);\r\n      } else {\r\n        setIsTyping(false);\r\n      }\r\n    });\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      newSocket.off('receive_message');\r\n      newSocket.off('user_typing');\r\n      newSocket.disconnect();\r\n    };\r\n  }, [chatId, token]);\r\n\r\n  // Scroll to bottom when messages change\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Handle sending a message\r\n  const handleSendMessage = (content: string) => {\r\n    if (socket && content.trim() !== '') {\r\n      const newMessage: Message = {\r\n        _id: Date.now().toString(),\r\n        sender: 'current_user', // This would be the actual user ID\r\n        senderType: 'user',\r\n        content,\r\n        timestamp: new Date(),\r\n        read: false,\r\n        sentiment: 'neutral'\r\n      };\r\n\r\n      socket.emit('send_message', {\r\n        chatId,\r\n        message: newMessage\r\n      });\r\n\r\n      setMessages(prev => [...prev, newMessage]);\r\n    }\r\n  };\r\n\r\n  // Handle typing start/stop\r\n  const handleTypingStart = () => {\r\n    if (socket) {\r\n      socket.emit('typing_start', { chatId, user: 'current_user' });\r\n    }\r\n  };\r\n\r\n  const handleTypingStop = () => {\r\n    if (socket) {\r\n      socket.emit('typing_stop', { chatId, user: 'current_user' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-window\">\r\n      <ChatHeader chatId={chatId} />\r\n      \r\n      <div className=\"chat-messages\">\r\n        {messages.map((message) => (\r\n          <MessageBubble \r\n            key={message._id} \r\n            message={message} \r\n          />\r\n        ))}\r\n        {isTyping && (\r\n          <div className=\"typing-indicator\">\r\n            {typingUser} is typing...\r\n          </div>\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n      \r\n      <ChatInput \r\n        onSendMessage={handleSendMessage}\r\n        onTypingStart={handleTypingStart}\r\n        onTypingStop={handleTypingStop}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWindow;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}